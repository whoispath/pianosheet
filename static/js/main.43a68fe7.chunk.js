(this["webpackJsonpmidi-playpen-ts"]=this["webpackJsonpmidi-playpen-ts"]||[]).push([[0],{108:function(e,n,t){},109:function(e,n,t){},142:function(e,n,t){"use strict";t.r(n);var o=t(0),a=t.n(o),r=t(11),i=t.n(r),c=t(26),l=(t(108),t(12)),u=(t(109),t(178)),s=t(195),d=t(181),f=t(183),b=t(185),p=t(189),v=t(191),j=t(184),m=t(60),h=t.n(m),g=t(20),O=t(4),B=Object(u.a)((function(e){return Object(s.a)({root:{width:"100%"},marginTop:{marginTop:8},barNoAnimation:{animation:"none"},paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary,position:"relative"}})})),x=Object(c.b)((function(e){return{sheet:e.sheetSlice}}),null)((function(e){var n=B(),t=a.a.useState(void 0),o=Object(l.a)(t,2),r=o[0],i=o[1],c=a.a.useState(Object(g.uniqueId)("paper-")),u=Object(l.a)(c,2),s=u[0],m=(u[1],a.a.useState(Object(g.uniqueId)("warning-"))),x=Object(l.a)(m,2),D=x[0],y=(x[1],a.a.useRef(null)),A=a.a.useRef(null),S=a.a.useRef(null);return a.a.useEffect((function(){r&&r.fireChanged()}),[r,e.abcNotation]),a.a.useEffect((function(){var e=new ResizeObserver((function(e){var n=window.getComputedStyle(e[0].target,null),t=parseInt(n.width)-r.engraver_controller.renderer.padding.left-r.engraver_controller.renderer.padding.right;r.paramChanged({staffwidth:t}),console.log(t)}));return A&&A.current&&e.observe(A.current),function(){e.disconnect()}}),[r,A]),a.a.useEffect((function(){if(y&&y.current&&A&&A.current&&S&&S.current){var e=new h.a.Editor("outlined-multiline-static",{paper_id:s,warnings_id:D});i(e)}}),[y,A,S,s,D]),Object(O.jsx)(d.a,{children:Object(O.jsxs)(f.a,{container:!0,spacing:3,children:[Object(O.jsxs)(f.a,{item:!0,xs:8,children:[Object(O.jsx)(j.a,{variant:"contained",color:"primary",onClick:function(){var n=new h.a.synth.CreateSynth,t=document.createElement("div"),o=h.a.renderAbc(t,e.abcNotation);n.init({visualObj:o[0]}).then((function(e){return console.log("Audio object has been initialized"),n.prime()})).then((function(){return console.log("Audio object has been primed"),n.start(),console.log("Audio started"),Promise.resolve()})).catch((function(e){"NotSupported"===e.status||console.warn("synth error",e)}))},children:"Play"}),Object(O.jsx)(b.a,{className:n.paper,id:s,ref:A,style:{padding:0}})]}),Object(O.jsxs)(f.a,{item:!0,xs:4,children:[Object(O.jsx)(p.a,{id:"outlined-multiline-static",inputRef:y,label:"Multiline",multiline:!0,fullWidth:!0,rows:30,variant:"outlined",value:e.abcNotation,onChange:function(n){return e.setAbcNotation&&e.setAbcNotation(n.target.value)},onSelect:function(e){console.log("onSelect",e)},onSelectCapture:function(e){console.log("onSelectCapture",e)}}),Object(O.jsx)(v.a,{severity:"warning",id:D,ref:S,children:"This is an error alert \u2014 check it out!"})]})]})})})),D=t(13),y=t.n(D);y.a.enable((function(e){if(e?console.log("WebMidi could not be enabled.",e):(console.log("WebMidi enabled!"),console.log(y.a.inputs),console.log(y.a.outputs)),0!==y.a.inputs.length){console.log(y.a.inputs[0].id);y.a.outputs[0];y.a.inputs[0].addListener("pitchbend","all",(function(e){console.log(e)}))}}));var A={};function S(e,n){A[e]=n}function I(){var e=[],n=void 0,t=void 0;function o(e,n,t){if("function"===typeof e.init&&e.init(n,t),"object"===typeof e.input){var o=e.input;"function"===typeof o.noteon&&(null===n||void 0===n||n.addListener("noteon","all",o.noteon)),"function"===typeof o.noteoff&&(null===n||void 0===n||n.addListener("noteoff","all",o.noteoff))}}function a(e,n,t){if("object"===typeof e.input){var o=e.input;"function"===typeof o.noteon&&(null===n||void 0===n||n.removeListener("noteon","all",o.noteon)),"function"===typeof o.noteoff&&(null===n||void 0===n||n.removeListener("noteoff","all",o.noteoff))}"function"===typeof e.destroy&&e.destroy()}function r(e){console.log("connected",e)}function i(e){var o,a;console.log("disconnected",e),(null===(o=n)||void 0===o?void 0:o.id)!==e.port.id&&(null===(a=t)||void 0===a?void 0:a.id)!==e.port.id||l()}function c(){y.a.addListener("connected",r),y.a.addListener("disconnected",i)}function l(){e.forEach((function(e){a(e,n)}))}return y.a.enabled?c():y.a.enable((function(){c()})),{switchInputOutput:function(a,r){var i=void 0,c=void 0;y.a.inputs.forEach((function(e){e.name===a&&(i=e)})),y.a.outputs.forEach((function(e){e.name===r&&(c=e)})),i===n&&c===t||(l(),n=i,t=c,e.forEach((function(e){o(e,n,t)})))},installModule:function(a,r){var i=A[a];if(i){var c=i(r);return o(c,n,t),e.push(c),c}},uninstallModule:function(t){var o=e.find((function(e){return e.name===t}));void 0!==o&&(e=e.filter((function(e){return e.name!==t})),a(o,n))},destroy:function(){l(),y.a.removeListener("connected",r),y.a.removeListener("disconnected",i)},getInputDevices:function(){return y.a.inputs},getOutputDevices:function(){return y.a.outputs},installedModule:function(){return e},availableModule:function(){return Object(g.keys)(A)}}}var M=t(190),C=t(144),E=t(192),F=t(197),N=t(188),w=t(196),T=t(186),P=Object(u.a)((function(e){return Object(s.a)({root:{width:"100%"},marginTop:{marginTop:8},barNoAnimation:{animation:"none"},typography:{padding:e.spacing(2)}})})),L=Object(c.b)((function(e){return{sheet:e.sheetSlice}}),null)((function(e){var n,t,o=P(),r=a.a.useState(null),i=Object(l.a)(r,2),c=i[0],u=i[1],s=Boolean(c),d=s?"simple-popover":void 0,f=a.a.useState(""),b=Object(l.a)(f,2),p=b[0],v=b[1],m=a.a.useState(""),h=Object(l.a)(m,2),g=h[0],B=h[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(j.a,{onClick:function(e){u(e.currentTarget)},variant:"outlined",children:"Select MIDI device"}),Object(O.jsxs)(M.a,{id:d,open:s,anchorEl:c,onClose:function(){var n;u(null),null===(n=e.processor)||void 0===n||n.switchInputOutput(p,g)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(O.jsx)(C.a,{className:o.typography,children:"Select from the available MIDI devices here:"}),Object(O.jsxs)(w.a,{component:"fieldset",children:[Object(O.jsx)(T.a,{component:"legend",children:"MIDI devices for input:"}),Object(O.jsxs)(F.a,{"aria-label":"gender",name:"gender1",value:p,onChange:function(e){v(e.target.value)},children:[Object(O.jsx)(N.a,{value:"",control:Object(O.jsx)(E.a,{}),label:"None"}),null===(n=e.processor)||void 0===n?void 0:n.getInputDevices().map((function(e){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(N.a,{value:e.name,control:Object(O.jsx)(E.a,{}),label:e.name})})}))]})]}),Object(O.jsxs)(w.a,{component:"fieldset",children:[Object(O.jsx)(T.a,{component:"legend",children:"MIDI devices for output:"}),Object(O.jsxs)(F.a,{"aria-label":"gender",name:"gender1",value:g,onChange:function(e){B(e.target.value)},children:[Object(O.jsx)(N.a,{value:"",control:Object(O.jsx)(E.a,{}),label:"None"}),null===(t=e.processor)||void 0===t?void 0:t.getOutputDevices().map((function(e){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(N.a,{value:e.name,control:Object(O.jsx)(E.a,{}),label:e.name})})}))]})]})]})]})})),k=t(194),R=t(187),z=t(193),G=Object(u.a)((function(e){return Object(s.a)({root:{width:"100%"},marginTop:{marginTop:8},barNoAnimation:{animation:"none"},typography:{padding:e.spacing(2)}})})),q=function(e){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(N.a,{control:Object(O.jsx)(z.a,{checked:e.installed,onChange:e.onChange,name:e.moduleName}),label:e.moduleName})})},J=Object(c.b)((function(e){return{sheet:e.sheetSlice}}),null)((function(e){var n,t=G(),o=a.a.useState(null),r=Object(l.a)(o,2),i=r[0],c=r[1],u=Boolean(i),s=u?"simple-popover":void 0,d=a.a.useState(""),f=Object(l.a)(d,2),b=f[0],p=(f[1],a.a.useState("")),v=Object(l.a)(p,2),m=v[0],h=(v[1],a.a.useState([])),g=Object(l.a)(h,2),B=g[0],x=g[1],D=a.a.useCallback((function(n,t,o){if(e.processor){var a=e.processor;o?a.installModule(n):a.uninstallModule(n);var r=a.installedModule().map((function(e){return e.name}));x(r)}}),[e.processor]);return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(j.a,{onClick:function(e){c(e.currentTarget)},variant:"outlined",children:"Select MIDI process modules"}),Object(O.jsxs)(M.a,{id:s,open:u,anchorEl:i,onClose:function(){var n;c(null),null===(n=e.processor)||void 0===n||n.switchInputOutput(b,m)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(O.jsx)(C.a,{className:t.typography,children:"Select from the available MIDI process modules here:"}),Object(O.jsxs)(w.a,{component:"fieldset",children:[Object(O.jsx)(T.a,{component:"legend",children:"MIDI process modules:"}),Object(O.jsx)(R.a,{children:null===(n=e.processor)||void 0===n?void 0:n.availableModule().map((function(n){return Object(O.jsx)(q,{processor:e.processor,moduleName:n,installed:-1!==B.indexOf(n),onChange:D.bind(undefined,n)})}))})]})]})]})})),V=t(73),_=["C","^C","D","^D","E","F","^F","G","^G","A","^A","B"],K=["C,,,,","C,,,","C,,","C,","C","c","c'","c''","c'''"];function W(e){if(e<21||e>108)return"C,,,,";var n=_[(e-60+120)%12],t=K[(e-12)/12|0];return"c"===t[0]&&(n=n.toLowerCase()),t=t.slice(1),"".concat(n).concat(t)}function X(e,n,t){return e===t?"":e%t===0?"".concat(e/t):"".concat(e,"/").concat(t)}function Q(e,n,t){for(var o="",a=0,r=[],i=0,c=function(c){if(c>0&&c%t.slotsPerMeasure===0&&(c>i&&(o+="z".concat(X(c-i,t.beatsPerMeasure,t.defaultBeatInSlots))),r.push({measureIndex:a,notations:o}),o="",a++,i=c),c in n&&n[c].length>0){for(var l=1,u=c+1;u<=e+t.slotsPerMeasure;u++){if(u%t.slotsPerMeasure===0){l=u-c;break}if(u in n&&n[u].length>0){l=u-c;break}}c>i&&(o+="z".concat(X(c-i,t.beatsPerMeasure,t.defaultBeatInSlots)));var s=0,d=n[c].map((function(o){var a=(o.duration+.8*t.slotDuration)/t.slotDuration|0;if(a>l){var r=Object(V.a)(Object(V.a)({},o),{},{duration:o.duration-l*t.slotDuration});c+l in n?n[c+l].push(r):n[c+l]=[r],e=Math.max(e,c+l);var i="".concat(W(o.n)).concat(X(l,t.beatsPerMeasure,t.defaultBeatInSlots),"-");return s=Math.max(l,a),i}var u="".concat(W(o.n)).concat(X(a,t.beatsPerMeasure,t.defaultBeatInSlots));return s=Math.max(s,a),u}));d.length>1?o+="[".concat(Object(g.join)(d,""),"]"):o+=d[0],i=c+s}},l=0;l<=e;l++)c(l);return o.length>0&&(r.push({measureIndex:a,notations:o}),a++),r}function U(e){var n,t=null===(n=Object(g.minBy)(e,"begin"))||void 0===n?void 0:n.begin;if(void 0===t)return"";var o=6e4;return function(e,n,t){for(var o=0,a={},r=(n.forEach((function(n,r){var i=n.begin-e,c=(i+t.slotDuration/2)/t.measureDuration|0,l=Math.max(0,i-c*t.measureDuration+t.slotDuration/2)/t.slotDuration|0,u=c*t.slotsPerMeasure+l;o=Math.max(u,o),u in a?a[u].push(n):a[u]=[n]})),{}),i={},c=0;c<=o;c++)c in a&&(r[c]=Object(g.filter)(a[c],(function(e){return e.n>=60})),i[c]=Object(g.filter)(a[c],(function(e){return e.n<60})));for(var l=Q(o,r,t),u=Q(o,i,t),s=["X: 1\nT: Untitled\nM: ".concat(t.beatsPerMeasure,"/").concat(t.defaultBeat,"\nL: 1/8\nR: reel\nK: D"),"%%score (T1) (B1)",'V:T1  clef=treble-8  name="Tenore I"   snm="T.I"','V:B1  clef=bass      name="Basso I"    snm="B.I"  octave=-2'],d=Math.max(l.length,u.length),f=0;f<d;f+=3)s.push("% ".concat(f+1)),s.push("[V:T1]".concat(l.slice(f,f+3).map((function(e){return e.notations})).join(" | ")," |")),s.push("[V:B1]".concat(u.slice(f,f+3).map((function(e){return e.notations})).join(" | ")," |"));return s.join("\n")}(t,e,{bpm:60,msPerMinute:o,beatsPerMeasure:4,measureDuration:4e3,beatDuration:1e3,defaultBeat:4,resolution:8,slotDuration:500,slotsPerMeasure:8,defaultBeatInSlots:2})}var H=t(91);S("recorder",(function(){var e=null,n={},t=[];return{name:"recorder",start:function(){e=new Date,n={},t=[]},input:{noteon:function(e){n[e.note.number]=e},noteoff:function(o){var a=new Date,r=n[o.note.number];delete n[o.note.number];var i=a.getTime()-o.timestamp+r.timestamp-(e?e.getTime():0),c={n:o.note.number,begin:i,duration:o.timestamp-r.timestamp,velocity:r.velocity};t.push(c),console.log("Recorded:",c)}},getSequence:function(){return Object(H.a)(t)}}})),S("repeater",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3,n={},t=null;return{name:"repeater",init:function(e,n){e||null,t=n||null},destroy:function(){null,t=null},start:function(){new Date,n={}},input:{noteon:function(o){var a=o;console.log(o),n[a.note.number]=o,setTimeout((function(){var e;null===(e=t)||void 0===e||e.playNote(o.note.number,"all",{velocity:o.velocity})}),e)},noteoff:function(o){var a=o;console.log(o);n[a.note.number];delete n[a.note.number],setTimeout((function(){var e;null===(e=t)||void 0===e||e.stopNote(o.note.number)}),e)}}}})),S("metronome",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{beats:[],notes:[],bpm:60,program:16,channel:16},n=null,t=0,o=void 0;return(void 0===e.program||e.channel<0||e.channel>127)&&(e.program=16),(void 0===e.channel||e.channel<0||e.channel>16)&&(e.channel=16),{name:"metronome",defaultOptions:function(){return{beats:[],notes:[],bpm:60,program:16,channel:16}},init:function(a,r){var i;a||null,null===(i=n=r||null)||void 0===i||i.sendProgramChange(e.program,e.channel),o=setInterval((function(){if(t+=1,n){var o=.25;e.beats.length>0&&(o=e.beats[t%e.beats.length]);var a="C3";e.notes.length>0&&(a=e.notes[t%e.notes.length]),n.playNote(a,16,{duration:10,velocity:o/2})}}),6e4/e.bpm)},destroy:function(){o&&clearInterval(o),o=void 0,null,n=null},start:function(){new Date,t=0},input:{}}}));var Y=function(){var e=a.a.useState(void 0),n=Object(l.a)(e,2),t=n[0],r=n[1],i=a.a.useState(void 0),c=Object(l.a)(i,2),u=c[0],s=c[1],d=a.a.useState(void 0),f=Object(l.a)(d,2),b=f[0],p=f[1];Object(o.useEffect)((function(){var e=I(),n=e.installModule("recorder"),t=e.installModule("metronome",{beats:[.25,.1,.15,.1],notes:["C3","G2","A2","G2"],bpm:60});return r(e),s(n),p(t),function(){s(void 0),p(void 0),r(void 0),e.destroy()}}),[]);var v=a.a.useState([]),m=Object(l.a)(v,2),h=m[0],B=m[1],D=a.a.useState(0),y=Object(l.a)(D,2),A=y[0],S=y[1];Object(o.useEffect)((function(){var e=setInterval((function(){var e=u?u.getSequence():[];B((function(n){if(Object(g.isEqual)(e,n))return n;var t=Object(g.minBy)(e,"begin");return void 0!==t&&S(t.begin),e}))}),1e3);return function(){clearInterval(e)}}),[u]);var M=a.a.useState("X: 1\nT: Test\nM: 4/4\nL: 1/8\nR: reel\nK: D\n|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|\nEBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2:|\n|:gf|eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|\neB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2:|\n"),C=Object(l.a)(M,2),E=C[0],F=C[1];return Object(o.useEffect)((function(){F(U(h))}),[h,A]),Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)("header",{className:"App-header",children:"Connect to your MIDI device and play."}),Object(O.jsx)(L,{processor:t}),Object(O.jsx)(J,{processor:t}),Object(O.jsx)(j.a,{color:"primary",variant:"contained",onClick:function(){null===u||void 0===u||u.start(),null===b||void 0===b||b.start()},children:"Record"}),Object(O.jsx)(j.a,{color:"primary",variant:"contained",onClick:function(){},children:"Play"}),Object(O.jsx)(x,{abcNotation:E,setAbcNotation:F}),h.map((function(e,n){return Object(O.jsx)(k.a,{label:"".concat(W(e.n)," ").concat(((e.begin-A)/1e3).toFixed(2)," - ").concat((e.duration/1e3).toFixed(2))},n)}))]})},Z=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,198)).then((function(n){var t=n.getCLS,o=n.getFID,a=n.getFCP,r=n.getLCP,i=n.getTTFB;t(e),o(e),a(e),r(e),i(e)}))},$=t(45),ee=t(25),ne=Object($.b)({name:"sheet",initialState:function(){var e={abcNotation:"X: 1\nT: Cooley's\nM: 4/4\nL: 1/8\nR: reel\nK: Emin\n|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|\nEBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2:|\n|:gf|eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|\neB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2:|\n"};try{var n=localStorage.getItem("sheet");null!==n&&(e=JSON.parse(n))}catch(t){console.log("getInitialState: load jobQuery caught err:",t)}return e}(),reducers:{setAbcNotation:function(e,n){e.abcNotation=n.payload,function(e){try{var n=JSON.stringify(e);localStorage.setItem("sheet",n)}catch(t){console.log("updateLocalStorage: caught err:",t)}}(e)}}}),te=Object(ee.b)({sheetSlice:ne.reducer}),oe=Object($.a)({reducer:te});i.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(c.a,{store:oe,children:Object(O.jsx)(Y,{})})}),document.getElementById("root")),Z()}},[[142,1,2]]]);
//# sourceMappingURL=main.43a68fe7.chunk.js.map